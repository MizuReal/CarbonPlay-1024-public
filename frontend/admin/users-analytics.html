<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | Users Analytics</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="../dist/styles.css" />
  <style>
    body { font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
  </style>
  <script>
    (function(){
      const t = localStorage.getItem('theme') || 'carbonplay';
      document.documentElement.setAttribute('data-theme', t);
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="icon" href="data:," />
  <meta name="robots" content="noindex" />
</head>
<body>
  <div class="bg-base-200 min-h-screen">
    <header class="bg-base-100 border-b">
      <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a href="index.html" class="btn btn-ghost btn-sm" title="Back to Admin"><i class="fa-solid fa-arrow-left"></i></a>
          <div>
            <h1 class="text-xl md:text-2xl font-semibold">Users Analytics</h1>
            <p class="text-xs md:text-sm text-base-content/60">Usage, participation, and carbon tracking</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <select id="windowSelect" class="select select-bordered select-sm">
            <option value="30">Last 30 days</option>
            <option value="7">Last 7 days</option>
            <option value="90">Last 90 days</option>
          </select>
          <button id="downloadPdfBtn" class="btn btn-outline btn-sm" title="Download as PDF"><i class="fa-solid fa-file-pdf mr-2"></i>Download PDF</button>
          <button id="refreshBtn" class="btn btn-ghost" title="Refresh"><i class="fa-solid fa-rotate"></i></button>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <!-- KPI cards -->
      <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="text-sm opacity-60">Users</div>
            <div id="kpi-users-total" class="text-3xl font-semibold">--</div>
            <div class="text-xs opacity-60"><span id="kpi-users-active">--</span> active • <span id="kpi-users-participants">--</span> participants</div>
          </div>
        </div>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="text-sm opacity-60">Activities</div>
            <div id="kpi-activities-total" class="text-3xl font-semibold">--</div>
            <div class="text-xs opacity-60">in window</div>
          </div>
        </div>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="text-sm opacity-60">Emissions</div>
            <div id="kpi-emissions-total" class="text-3xl font-semibold">--</div>
            <div class="text-xs opacity-60">kg CO₂e in window</div>
          </div>
        </div>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="text-sm opacity-60">Enrollments</div>
            <div id="kpi-enrollments-total" class="text-3xl font-semibold">--</div>
            <div class="text-xs opacity-60"><span id="kpi-enrollments-completed">--</span> completed</div>
          </div>
        </div>
      </section>

      <!-- Line graph: All user activities per day -->
      <section class="card bg-base-100 shadow">
        <div class="card-body">
          <div class="flex items-center justify-between">
            <h2 class="card-title">All User Activities (per day)</h2>
            <span class="text-xs opacity-60">Count of logged activities</span>
          </div>
          <div id="chart-activity-trend" class="h-72"></div>
        </div>
      </section>

      <!-- Emissions and participation -->
      <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="card bg-base-100 shadow lg:col-span-2">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h2 class="card-title">Daily Emissions</h2>
              <span class="text-xs opacity-60">kg CO₂e per day</span>
            </div>
            <div id="chart-emissions-trend" class="h-72"></div>
          </div>
        </div>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h2 class="card-title">Enrollments</h2>
              <span class="text-xs opacity-60">Completed vs ongoing</span>
            </div>
            <div id="chart-enrollments" class="h-72"></div>
          </div>
        </div>
      </section>

      <!-- Category and challenge types -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h2 class="card-title">Emissions by Category</h2>
              <span class="text-xs opacity-60">In selected window</span>
            </div>
            <div id="chart-category" class="h-72"></div>
          </div>
        </div>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <div class="flex items-center justify-between">
              <h2 class="card-title">Enrollments by Challenge Type</h2>
            </div>
            <div id="chart-challenge-types" class="h-72"></div>
          </div>
        </div>
      </section>

      <!-- Leaderboards -->
      <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h2 class="card-title">Top Users by Emissions (window)</h2>
            <div class="overflow-x-auto">
              <table class="table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th class="text-right">kg CO₂e</th>
                  </tr>
                </thead>
                <tbody id="tbody-top-emissions">
                  <tr><td colspan="2" class="text-center text-base-content/60">Loading…</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h2 class="card-title">Top Users by XP</h2>
            <div class="overflow-x-auto">
              <table class="table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th class="text-right">XP</th>
                  </tr>
                </thead>
                <tbody id="tbody-top-xp">
                  <tr><td colspan="2" class="text-center text-base-content/60">Loading…</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="../js/admin-notify.js"></script>
  <script src="../js/admin-users-analytics.js"></script>
</body>
</html>
