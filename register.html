<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | CarbonPlay-API</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="frontend/dist/styles.css">
    <!-- Styles removed: migrated to Tailwind. Page now uses Tailwind/DaisyUI utility classes -->
</head>
<body>
    <div id="navbar-placeholder"></div>
    <main class="min-h-screen flex items-center justify-center bg-gradient-to-br from-base-200 to-green-50 p-6">
        <a href="index.html" class="absolute top-5 left-5 text-base-content/80 hover:text-primary flex items-center gap-2"><i class="fas fa-arrow-left"></i>Back</a>

        <div class="w-full max-w-4xl bg-base-100 shadow-xl rounded-lg overflow-hidden flex flex-col md:flex-row">
            <div class="md:w-2/5 bg-[linear-gradient( rgba(46,204,113,0.7), rgba(52,152,219,0.7) ),url('frontend/images/environment-bg.jpg')] bg-cover bg-center p-10 flex flex-col justify-center items-center text-white">
                <h2 class="text-2xl font-semibold mb-3">Join CarbonPlay</h2>
                <p class="mb-6 text-sm">Create an account to start tracking and reducing your carbon footprint through our interactive platform.</p>
                <div class="flex items-center gap-2 text-lg font-semibold"><i class="fas fa-leaf"></i> CarbonPlay-API</div>
            </div>

            <div class="md:w-3/5 p-10">
                <h3 class="text-xl font-semibold text-base-content mb-6 text-center">Create an Account</h3>
                <form id="registerForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="firstName" class="block text-sm font-medium mb-1">First Name</label>
                            <input id="firstName" name="firstName" required class="input input-bordered w-full" />
                        </div>
                        <div>
                            <label for="lastName" class="block text-sm font-medium mb-1">Last Name</label>
                            <input id="lastName" name="lastName" required class="input input-bordered w-full" />
                        </div>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium mb-1">Email</label>
                        <input id="email" name="email" type="email" required class="input input-bordered w-full" />
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="password" class="block text-sm font-medium mb-1">Password</label>
                            <input id="password" name="password" type="password" required class="input input-bordered w-full" />
                        </div>
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium mb-1">Confirm Password</label>
                            <input id="confirmPassword" name="confirmPassword" type="password" required class="input input-bordered w-full" />
                        </div>
                    </div>
                    <label class="flex items-start gap-2">
                        <input type="checkbox" id="terms" name="terms" class="checkbox mt-1" required />
                        <span class="text-sm">I agree to the <a href="#" class="link link-primary">Terms of Service</a> and <a href="#" class="link link-primary">Privacy Policy</a></span>
                    </label>
                    <div>
                        <button type="submit" class="btn btn-primary w-full">Create Account</button>
                    </div>
                    <p class="text-center text-sm">Already have an account? <a href="login.html" class="link link-primary">Sign in</a></p>
                </form>
            </div>
        </div>
    </main>

    <script src="frontend/js/admin-notify.js"></script>
    <script>
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                if (window.notify?.warning) window.notify.warning('Passwords do not match!');
                else alert('Passwords do not match!');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        firstName, 
                        lastName, 
                        email, 
                        password 
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Persist a flash message so the user sees it on the next page
                    try { sessionStorage.setItem('flashMessage', 'account sucessfully created'); } catch (_) {}
                    window.location.href = 'login.html';
                } else {
                    if (window.notify?.error) window.notify.error(data.message || 'Registration failed. Please try again.');
                    else alert(data.message || 'Registration failed. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                if (window.notify?.error) window.notify.error('An error occurred during registration. Please try again.');
                else alert('An error occurred during registration. Please try again.');
            }
        });
    </script>
    <script src="frontend/js/navbar.js"></script>
    <script>loadNavbar();</script>
</body>
</html>
